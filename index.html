<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Calendula</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
    }
    
    body {
      padding: 20px;
      background-color: #f5f5f5;
    }
    
    .date-time-picker {
      max-width: 550px;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      margin: 0 auto;
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;
    }
    
    .calendar-container {
      flex: 1;
      min-width: 280px;
      border-right: 1px solid #eee;
    }
    
    .time-container {
      width: 240px;
      background-color: #d8ecff;
    }
    
    /* Media query for mobile device */
    @media (max-width: 540px) {
      .date-time-picker {
        flex-direction: column;
      }
      
      .calendar-container {
        border-right: none;
        border-bottom: 1px solid #eee;
        width: 100%;
      }
      
      .time-container {
        width: 100%;
      }
    }
    
    .input-container {
      padding: 12px;
      border-bottom: 1px solid #eee;
    }
    
    .date-input {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 16px;
    }
    
    @media (max-width: 540px) {
      .input-container {
        padding: 10px;
      }
      
      .date-input {
        font-size: 14px;
        padding: 8px;
      }
    }
    
    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px;
      background-color: #f9f9f9;
    }
    
    .month-nav {
      display: flex;
      align-items: center;
    }
    
    .month-nav button {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 18px;
      padding: 4px 8px;
      border-radius: 4px;
    }
    
    .month-nav button:hover {
      background-color: #f0f0f0;
    }
    
    .month-title {
      font-weight: bold;
      margin: 0 12px;
    }
    
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      padding: 8px;
    }
    
    .weekday {
      text-align: center;
      font-weight: bold;
      color: #666;
      font-size: 14px;
      padding: 8px 0;
    }
    
    .calendar-day {
      text-align: center;
      padding: 8px 0;
      cursor: pointer;
      border-radius: 4px;
    }
    
    .calendar-day:hover {
      background-color: #f0f0f0;
    }
    
    .empty-day {
      visibility: hidden;
    }
    
    .today {
      background-color: #e6f2ff;
    }
    
    .selected {
      background-color: #007bff;
      color: white;
    }
    
    .selected:hover {
      background-color: #0069d9;
    }
    
    .time-section {
      padding: 12px;
      border-bottom: 1px solid #eee;
    }
    
    .time-title {
      font-size: 14px;
      font-weight: bold;
      color: #666;
      margin-bottom: 8px;
      text-align: center;
    }
    
    .time-grid {
      display: grid;
      gap: 4px;
      margin-top: 6px;
    }
    
    .hours-grid {
      grid-template-columns: repeat(6, 1fr);
    }

    .ten-minutes-grid {
      grid-template-columns: repeat(6, 1fr);
      grid-template-rows: repeat(1, 1fr);
    }

    .minutes-grid {
      grid-template-columns: repeat(5, 1fr);
      grid-template-rows: repeat(2, 1fr);
    }

    .seconds-grid {
      grid-template-columns: repeat(6, 1fr);
    }

    .time-item {
      padding: 6px 0;
      font-size: 13px;
      text-align: center;
      cursor: pointer;
      border-radius: 4px;
      background-color: #fff;
    }
    
    .time-item:hover {
      background-color: #f0f1f2;
    }
    
    @media (max-width: 540px) {
      .time-section {
        padding: 10px;
      }
      
      .time-grid {
        gap: 3px;
      }
      
      .time-item {
        padding: 8px 0;
        font-size: 14px;
      }
    }
    
    .time-item.selected {
      background-color: #007bff;
      color: white;
    }
    
    .time-item.selected:hover {
      background-color: #0069d9;
    }
  </style>
</head>
<body>
  <div class="input-container">
    <input type="text" class="date-input" id="dateInput" placeholder="DD.MM.YYYY HH:MM:SS">
  </div>
  
  <div class="date-time-picker" id="datePicker">
    <div class="calendar-container">
      <div class="calendar-header">
        <div class="month-nav">
          <button id="prevMonth">&lt;</button>
          <div class="month-title" id="monthTitle">March 2025</div>
          <button id="nextMonth">&gt;</button>
        </div>
      </div>
      
      <div class="calendar-grid" id="calendarGrid">
        <!-- Days of week will be added using JavaScript -->
        <!-- Days of month will be added using JavaScript -->
      </div>
    </div>
    
    <div class="time-container">
      <div class="time-section">
        <div class="time-title">Hours</div>
        <div class="time-grid hours-grid" id="hoursGrid">
          <!-- Hours will be added using JavaScript -->
        </div>
      </div>
      
      <div class="time-section">
        <div class="time-title">Minutes</div>
        <div class="time-section-container">
          <div class="time-title" style="font-size: 12px; margin-top: 8px;">Tens</div>
          <div class="time-grid ten-minutes-grid" id="tenMinutesGrid">
            <!-- Tens of minutes will be added using JavaScript -->
          </div>

          <div class="time-title" style="font-size: 12px; margin-top: 8px;">Minutes</div>
          <div class="time-grid minutes-grid" id="minutesGrid">
            <!-- Minutes will be added using JavaScript -->
          </div>
        </div>
      </div>
      
      <div class="time-section">
        <div class="time-title">Seconds</div>
        <div class="time-grid seconds-grid" id="secondsGrid">
          <!-- Seconds will be added using JavaScript -->
        </div>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const datePicker = {
        elements: {
          dateInput: document.getElementById('dateInput'),
          monthTitle: document.getElementById('monthTitle'),
          prevMonthBtn: document.getElementById('prevMonth'),
          nextMonthBtn: document.getElementById('nextMonth'),
          calendarGrid: document.getElementById('calendarGrid'),
          hoursGrid: document.getElementById('hoursGrid'),
          tenMinutesGrid: document.getElementById('tenMinutesGrid'),
          minutesGrid: document.getElementById('minutesGrid'),
          secondsGrid: document.getElementById('secondsGrid')
        },
        
        // Configuration options
        config: {
          showSeconds: false,  // Set to false to hide the seconds section
          minuteStep: 1        // Minute step: 1, 5, or 10
        },
        
        state: {
          currentDate: new Date(),
          selectedDate: new Date(),
          selectedHour: new Date().getHours(),
          selectedTenMinute: Math.floor(new Date().getMinutes() / 10) * 10,
          selectedMinute: new Date().getMinutes() % 10,
          selectedSecond: new Date().getSeconds(),
          cursorPosition: 0
        },
        
        init: function() {
          // Render all components first
          this.renderCalendarDays();
          this.renderHours();
          this.renderTenMinutes();
          this.renderMinutes();
          this.renderSeconds();
          
          // Now apply configuration settings to show/hide and format
          this.applyConfig();
          
          this.updateDateInput();
          this.bindEvents();
        },
        
        // Apply configuration settings to the UI
        applyConfig: function() {
          // Handle seconds visibility
          const secondsSection = document.querySelector('.time-section:last-child');
          if (secondsSection) {
            secondsSection.style.display = this.config.showSeconds ? 'block' : 'none';
          }
          
          // Handle minute step display
          const minuteStep = this.config.minuteStep;
          
          // Get minute containers
          const minutesSection = document.querySelector('.time-section:nth-child(2)');
          if (!minutesSection) return;
          
          const minuteSectionContainer = minutesSection.querySelector('.time-section-container');
          if (!minuteSectionContainer) return;
          
          const minutesTitle = minutesSection.querySelector('.time-title');
          const tenMinutesTitle = minuteSectionContainer.querySelector('.time-title:nth-child(1)');
          const minutesSubtitle = minuteSectionContainer.querySelector('.time-title:nth-child(3)');
          
          const tenMinutesGrid = document.getElementById('tenMinutesGrid');
          const minutesGrid = document.getElementById('minutesGrid');
          
          if (minuteStep === 1) {
            // For standard step, use the existing layout with tens and units
            minutesTitle.textContent = 'Minutes';
            
            // Show all components
            tenMinutesTitle.style.display = 'block';
            tenMinutesGrid.style.display = 'grid';
            minutesSubtitle.style.display = 'block';
            
            // Default grid layouts
            tenMinutesGrid.style.gridTemplateColumns = 'repeat(6, 1fr)';
            tenMinutesGrid.style.gridTemplateRows = 'repeat(1, 1fr)';
            minutesGrid.style.gridTemplateColumns = 'repeat(5, 1fr)';
            minutesGrid.style.gridTemplateRows = 'repeat(2, 1fr)';
          } else {
            // For step 5 or 10, use a single grid for all minutes
            minutesTitle.textContent = 'Minutes';
            
            // Hide tens components
            tenMinutesTitle.style.display = 'none';
            tenMinutesGrid.style.display = 'none';
            minutesSubtitle.style.display = 'none';
            
            // Configure grid layout based on step
            if (minuteStep === 5) {
              // 5-minute step: 12 buttons (0-55) in a 6x2 grid
              minutesGrid.style.gridTemplateColumns = 'repeat(6, 1fr)';
              minutesGrid.style.gridTemplateRows = 'repeat(2, 1fr)';
            } else if (minuteStep === 10) {
              // 10-minute step: 6 buttons (0-50) in a 6x1 grid
              minutesGrid.style.gridTemplateColumns = 'repeat(6, 1fr)';
              minutesGrid.style.gridTemplateRows = 'repeat(1, 1fr)';
            }
          }
        },
        
        bindEvents: function() {
          this.elements.prevMonthBtn.addEventListener('click', () => this.changeMonth(-1));
          this.elements.nextMonthBtn.addEventListener('click', () => this.changeMonth(1));
          
          // Handle clicks in the input field to track cursor position
          this.elements.dateInput.addEventListener('click', (e) => {
            this.state.cursorPosition = e.target.selectionStart;
          });
          
          // Handle paste event
          this.elements.dateInput.addEventListener('paste', (e) => {
            e.preventDefault();
            
            // Get clipboard data
            const clipboardData = e.clipboardData || window.clipboardData;
            const pastedText = clipboardData.getData('text');
            
            // Extract only digits from pasted text
            const digits = pastedText.replace(/\D/g, '');
            
            // Get the current cursor position directly from the element
            const currentPosition = e.target.selectionStart;
            
            // Update our stored position
            this.state.cursorPosition = currentPosition;
            
            if (digits.length > 0) {
              // Apply overwrite logic with multiple digits
              this.overwriteMultipleDigits(currentPosition, digits);
            }
          });
          
          // Handle key presses for digit overwriting and cursor movement
          this.elements.dateInput.addEventListener('keydown', (e) => {
            // Only handle printable characters and specific control keys
            // Check if the key is a printable character (single character key) or Delete/Backspace
            const isPrintableChar = e.key.length === 1;
            const isDeleteOrBackspace = e.key === 'Delete' || e.key === 'Backspace';
            
            // Navigation keys that should update cursor position
            const isNavigationKey = ['Home', 'End', 'ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown'].includes(e.key);
            
            // If it's a navigation key, update the cursor position after browser handles it
            if (isNavigationKey) {
              // Use setTimeout to let the browser update the cursor position first
              setTimeout(() => {
                this.state.cursorPosition = this.elements.dateInput.selectionStart;
              }, 0);
              return;
            }
            
            // If it's not a printable character or Delete/Backspace, ignore it
            if (!isPrintableChar && !isDeleteOrBackspace) {
              return;
            }
            
            // If Ctrl, Alt or Meta is pressed with a character, it's likely a shortcut - ignore it
            if (e.ctrlKey || e.altKey || e.metaKey) {
              return;
            }
            
            // Handle Backspace key - replace previous digit with 0
            if (e.key === 'Backspace') {
              e.preventDefault();
              const input = this.elements.dateInput;
              const cursorPos = input.selectionStart;
              const currentValue = input.value;
              
              // Find previous digit position
              let prevDigitPos = cursorPos - 1;
              while (prevDigitPos >= 0 && !/\d/.test(currentValue[prevDigitPos])) {
                prevDigitPos--;
              }
              
              if (prevDigitPos >= 0) {
                // Replace the digit with 0
                const newValue = 
                  currentValue.substring(0, prevDigitPos) + 
                  '0' + 
                  currentValue.substring(prevDigitPos + 1);
                
                input.value = newValue;
                
                // Move cursor to the position of the replaced digit
                input.selectionStart = prevDigitPos;
                input.selectionEnd = prevDigitPos;
                this.state.cursorPosition = prevDigitPos;
                
                // Update the calendar
                this.handleInputChange(false);
              }
              return;
            }
            
            // Handle Delete key - replace next digit with 0
            if (e.key === 'Delete') {
              e.preventDefault();
              const input = this.elements.dateInput;
              const cursorPos = input.selectionStart;
              const currentValue = input.value;
              
              // Find next digit position
              let nextDigitPos = cursorPos;
              while (nextDigitPos < currentValue.length && !/\d/.test(currentValue[nextDigitPos])) {
                nextDigitPos++;
              }
              
              if (nextDigitPos < currentValue.length) {
                // Replace the digit with 0
                const newValue = 
                  currentValue.substring(0, nextDigitPos) + 
                  '0' + 
                  currentValue.substring(nextDigitPos + 1);
                
                input.value = newValue;
                
                // Keep cursor at the same position
                input.selectionStart = cursorPos;
                input.selectionEnd = cursorPos;
                this.state.cursorPosition = cursorPos;
                
                // Update the calendar
                this.handleInputChange(false);
              }
              return;
            }
            
            e.preventDefault(); // Prevent default behavior for all other keys
            
            const input = this.elements.dateInput;
            const cursorPos = input.selectionStart;
            this.state.cursorPosition = cursorPos;
            const currentValue = input.value;
            
            // Handle digit keys
            if (/^\d$/.test(e.key)) {
              // Find next digit position
              let nextDigitPos = cursorPos;
              
              // Find the next digit position
              while (nextDigitPos < currentValue.length && !/\d/.test(currentValue[nextDigitPos])) {
                nextDigitPos++;
              }
              
              if (nextDigitPos < currentValue.length) {
                // Replace the digit at the found position
                const newValue = 
                  currentValue.substring(0, nextDigitPos) + 
                  e.key + 
                  currentValue.substring(nextDigitPos + 1);
                
                input.value = newValue;
                
                // Move cursor after the inserted digit
                input.selectionStart = nextDigitPos + 1;
                input.selectionEnd = nextDigitPos + 1;
                this.state.cursorPosition = nextDigitPos + 1;
                
                // Update the calendar based on new input
                this.handleInputChange(false);
              }
            } else {
              // For non-digit keys, just move the cursor if on a non-digit
              if (cursorPos < currentValue.length) {
                if (!/\d/.test(currentValue[cursorPos])) {
                  // Simply move the cursor forward by 1 if at a non-digit character
                  input.selectionStart = cursorPos + 1;
                  input.selectionEnd = cursorPos + 1;
                  this.state.cursorPosition = cursorPos + 1;
                } else {
                  // If on a digit, find the next non-digit or digit position
                  let nextPos = cursorPos;
                  while (nextPos < currentValue.length && /\d/.test(currentValue[nextPos])) {
                    nextPos++;
                  }
                  if (nextPos < currentValue.length) {
                    // Move past the non-digit character
                    nextPos++;
                  }
                  input.selectionStart = nextPos;
                  input.selectionEnd = nextPos;
                  this.state.cursorPosition = nextPos;
                }
              }
            }
          });
          
          // Keep the Enter key behavior
          this.elements.dateInput.addEventListener('keyup', (e) => {
            if (e.key === 'Enter') {
              this.handleInputChange();
            }
          });
          
          // When the input field receives focus, update cursor position
          this.elements.dateInput.addEventListener('focus', (e) => {
            // Update the cursor position to the current selection
            this.state.cursorPosition = e.target.selectionStart;
            
            // If there's no specific position (undefined, null, or 0), set it to beginning
            if (!this.state.cursorPosition) {
              e.target.selectionStart = 0;
              e.target.selectionEnd = 0;
              this.state.cursorPosition = 0;
            }
          });
          
          // Add a mouseup handler to catch cursor position changes from mouse clicks
          this.elements.dateInput.addEventListener('mouseup', (e) => {
            // Update cursor position after mouse selection is complete
            setTimeout(() => {
              this.state.cursorPosition = e.target.selectionStart;
            }, 0);
          });
        },
        
        updateMonthTitle: function() {
          const months = [
            'January', 'February', 'March', 'April', 'May', 'June',
            'July', 'August', 'September', 'October', 'November', 'December'
          ];
          
          this.elements.monthTitle.textContent = `${months[this.state.currentDate.getMonth()]} ${this.state.currentDate.getFullYear()}`;
        },
        
        changeMonth: function(delta) {
          this.state.currentDate.setMonth(this.state.currentDate.getMonth() + delta);
          this.updateMonthTitle();
          this.renderCalendarDays();
          
          // Update the month in the input field with digit overwrite
          const month = (this.state.currentDate.getMonth() + 1).toString().padStart(2, '0');
          this.overwriteDigitsInInput(3, month);
        },
        
        renderCalendarDays: function() {
          // Clearing the calendar
          this.elements.calendarGrid.innerHTML = '';
          
          // Adding days of the week
          const weekdays = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
          weekdays.forEach(day => {
            const dayElement = document.createElement('div');
            dayElement.className = 'weekday';
            dayElement.textContent = day;
            this.elements.calendarGrid.appendChild(dayElement);
          });
          
          // Get month days
          const year = this.state.currentDate.getFullYear();
          const month = this.state.currentDate.getMonth();
          
          // First day of the month
          const firstDay = new Date(year, month, 1);
          // Getting the day of the week (0-6, where 0 is Sunday)
          let firstDayOfWeek = firstDay.getDay();
          // Convert to a format where 0 is Monday and 6 is Sunday
          firstDayOfWeek = firstDayOfWeek === 0 ? 6 : firstDayOfWeek - 1;
          
          // Number of days in a month
          const daysInMonth = new Date(year, month + 1, 0).getDate();
          
          // Adding empty cells for the previous month's days
          for (let i = 0; i < firstDayOfWeek; i++) {
            const emptyDay = document.createElement('div');
            emptyDay.className = 'calendar-day empty-day';
            this.elements.calendarGrid.appendChild(emptyDay);
          }
          
          // Adding the current month's days
          const today = new Date();
          for (let day = 1; day <= daysInMonth; day++) {
            const dayElement = document.createElement('div');
            dayElement.className = 'calendar-day';
            dayElement.textContent = day;
            
            // Highlighting today's day
            if (day === today.getDate() && 
                month === today.getMonth() && 
                year === today.getFullYear()) {
              dayElement.classList.add('today');
            }
            
            // Highlighting the selected day
            if (day === this.state.selectedDate.getDate() && 
                month === this.state.selectedDate.getMonth() && 
                year === this.state.selectedDate.getFullYear()) {
              dayElement.classList.add('selected');
            }
            
            // Click handler
            dayElement.addEventListener('click', () => {
              this.selectDate(day);
            });
            
            this.elements.calendarGrid.appendChild(dayElement);
          }
          
          this.updateMonthTitle();
        },
        
        selectDate: function(day) {
          // Update the selected date
          this.state.selectedDate = new Date(
            this.state.currentDate.getFullYear(),
            this.state.currentDate.getMonth(),
            day,
            this.state.selectedHour,
            this.state.selectedTenMinute + this.state.selectedMinute,
            this.state.selectedSecond
          );
          
          // Redrawing the calendar
          this.renderCalendarDays();
          
          // Update the value in the input field with digit overwrite for the day
          const dayString = day.toString().padStart(2, '0');
          this.overwriteDigitsInInput(0, dayString);
        },
        
        renderHours: function() {
          this.elements.hoursGrid.innerHTML = '';
          
          // Create buttons for the clock (0-23)
          for (let hour = 0; hour < 24; hour++) {
            const hourElement = document.createElement('div');
            hourElement.className = 'time-item';
            hourElement.textContent = hour.toString().padStart(2, '0');
            
            if (hour === this.state.selectedHour) {
              hourElement.classList.add('selected');
            }
            
            hourElement.addEventListener('click', () => {
              this.selectHour(hour);
            });
            
            this.elements.hoursGrid.appendChild(hourElement);
          }
        },
        
        selectHour: function(hour) {
          this.state.selectedHour = hour;
          
          // Update the selected time
          this.state.selectedDate.setHours(hour);
          
          // Redrawing the clock
          this.renderHours();
          
          // Update the value in the input field with digit overwrite
          const hourString = hour.toString().padStart(2, '0');
          this.overwriteDigitsInInput(11, hourString);
        },
        
        renderTenMinutes: function() {
          this.elements.tenMinutesGrid.innerHTML = '';
          
          // Create buttons for tens of minutes (0, 10, 20, 30, 40, 50)
          const tenMinutes = [0, 10, 20, 30, 40, 50];
          
          tenMinutes.forEach(minute => {
            const minuteElement = document.createElement('div');
            minuteElement.className = 'time-item';
            minuteElement.textContent = minute.toString().padStart(2, '0');
            
            if (minute === this.state.selectedTenMinute) {
              minuteElement.classList.add('selected');
            }
            
            minuteElement.addEventListener('click', () => {
              this.selectTenMinute(minute);
            });
            
            this.elements.tenMinutesGrid.appendChild(minuteElement);
          });
        },
        
        selectTenMinute: function(minute) {
          this.state.selectedTenMinute = minute;
          
          // Update the selected time
          this.state.selectedDate.setMinutes(minute + this.state.selectedMinute);
          
          // Redrawing for tens of minutes
          this.renderTenMinutes();
          
          // Update the value in the input field with digit overwrite
          const minuteString = (minute + this.state.selectedMinute).toString().padStart(2, '0');
          this.overwriteDigitsInInput(14, minuteString);
        },
        
        renderMinutes: function() {
          this.elements.minutesGrid.innerHTML = '';
          
          if (this.config.minuteStep === 1) {
            // Standard mode - create buttons for units of minutes (0-9)
            for (let minute = 0; minute < 10; minute++) {
              const minuteElement = document.createElement('div');
              minuteElement.className = 'time-item';
              minuteElement.textContent = minute.toString();
              
              if (minute === this.state.selectedMinute) {
                minuteElement.classList.add('selected');
              }
              
              minuteElement.addEventListener('click', () => {
                this.selectMinute(minute);
              });
              
              this.elements.minutesGrid.appendChild(minuteElement);
            }
          } else {
            // Step mode (5 or 10) - create buttons for minutes with the configured step
            const step = this.config.minuteStep;
            const currentMinutes = this.state.selectedDate.getMinutes();
            
            // Calculate how many minutes to display (12 for step 5, 6 for step 10)
            const maxMinutes = 60 - step;
            
            for (let minute = 0; minute <= maxMinutes; minute += step) {
              const minuteElement = document.createElement('div');
              minuteElement.className = 'time-item';
              minuteElement.textContent = minute.toString().padStart(2, '0');
              
              // Check if this minute button should be selected
              const isSelected = minute <= currentMinutes && currentMinutes < minute + step;
              if (isSelected) {
                minuteElement.classList.add('selected');
              }
              
              minuteElement.addEventListener('click', () => {
                this.selectMinute(minute);
              });
              
              this.elements.minutesGrid.appendChild(minuteElement);
            }
          }
        },
        
        selectMinute: function(minute) {
          if (this.config.minuteStep === 1) {
            // Standard mode - keep track of tens and units separately
            this.state.selectedMinute = minute;
            
            // Update the selected time
            this.state.selectedDate.setMinutes(this.state.selectedTenMinute + minute);
            
            // Redrawing the minutes
            this.renderMinutes();
            
            // Update the value in the input field with digit overwrite
            const minuteString = (this.state.selectedTenMinute + minute).toString().padStart(2, '0');
            this.overwriteDigitsInInput(14, minuteString);
          } else {
            // Step mode - directly set the minutes
            this.state.selectedDate.setMinutes(minute);
            
            // For convenience, also update the state properties
            this.state.selectedTenMinute = Math.floor(minute / 10) * 10;
            this.state.selectedMinute = minute % 10;
            
            // Redrawing the minutes
            this.renderMinutes();
            
            // Update the value in the input field with digit overwrite
            const minuteString = minute.toString().padStart(2, '0');
            this.overwriteDigitsInInput(14, minuteString);
          }
        },
        
        renderSeconds: function() {
          this.elements.secondsGrid.innerHTML = '';
          
          // Create buttons for seconds (0-59, in increments of 5)
          for (let second = 0; second < 60; second += 5) {
            const secondElement = document.createElement('div');
            secondElement.className = 'time-item';
            secondElement.textContent = second.toString().padStart(2, '0');
            
            if (second <= this.state.selectedSecond && this.state.selectedSecond < second + 5) {
              secondElement.classList.add('selected');
            }
            
            secondElement.addEventListener('click', () => {
              this.selectSecond(second);
            });
            
            this.elements.secondsGrid.appendChild(secondElement);
          }
        },
        
        selectSecond: function(second) {
          this.state.selectedSecond = second;
          
          // Update the selected time
          this.state.selectedDate.setSeconds(second);
          
          // Redrawing the seconds
          this.renderSeconds();
          
          // Update the value in the input field with digit overwrite
          const secondString = second.toString().padStart(2, '0');
          this.overwriteDigitsInInput(17, secondString);
        },
        
        // Helper method to overwrite digits in the input field
        overwriteDigitsInInput: function(startPosition, newValue) {
          const input = this.elements.dateInput;
          const currentValue = input.value;
          
          // If input is empty, update with full date
          if (!currentValue) {
            this.updateDateInput();
            return;
          }
          
          let newInputValue = '';
          let valueIndex = 0;
          
          // Build the new string by replacing only the digits at positions
          for (let i = 0; i < currentValue.length; i++) {
            if (i >= startPosition && valueIndex < newValue.length) {
              // If we're at a digit position to replace
              if (/\d/.test(currentValue[i])) {
                // Replace the digit
                newInputValue += newValue[valueIndex];
                valueIndex++;
              } else {
                // Keep non-digit characters (like . : or space)
                newInputValue += currentValue[i];
              }
            } else {
              // Keep characters outside our replacement range
              newInputValue += currentValue[i];
            }
          }
          
          // Update input value
          input.value = newInputValue;
          
          // Update the calendar UI to match
          this.handleInputChange(false);
          
          // Set cursor position after the last digit we inserted
          input.focus();
          const newPosition = startPosition + newValue.length + 
                             (currentValue[startPosition + 1] === '.' || 
                              currentValue[startPosition + 1] === ':' || 
                              currentValue[startPosition + 1] === ' ' ? 1 : 0);
          input.selectionStart = newPosition;
          input.selectionEnd = newPosition;
          this.state.cursorPosition = newPosition;
        },
        
        // Method to handle pasting multiple digits
        overwriteMultipleDigits: function(startPosition, digits) {
          const input = this.elements.dateInput;
          const currentValue = input.value;
          
          // If input is empty, update with full date and we'll overwrite it
          if (!currentValue) {
            this.updateDateInput();
            return;
          }
          
          let newInputValue = currentValue;
          let currentPos = startPosition;
          let digitsReplaced = 0;
          
          // For each digit in the pasted content
          for (let i = 0; i < digits.length; i++) {
            // Find the next digit position in the input from our current position
            while (currentPos < newInputValue.length && !/\d/.test(newInputValue[currentPos])) {
              currentPos++;
            }
            
            // If we've reached the end of the input, stop
            if (currentPos >= newInputValue.length) {
              break;
            }
            
            // Replace the digit at current position
            newInputValue = 
              newInputValue.substring(0, currentPos) + 
              digits[i] + 
              newInputValue.substring(currentPos + 1);
              
            digitsReplaced++;
            currentPos++;
          }
          
          // Update input value
          input.value = newInputValue;
          
          // Update the calendar
          this.handleInputChange(false);
          
          // Position cursor after the last replaced digit
          input.focus();
          
          // Find a good cursor position after the pasted content
          let newPosition = startPosition;
          let digitsFound = 0;
          
          // Move through the string, counting digits until we've found all that we replaced
          while (newPosition < newInputValue.length && digitsFound < digitsReplaced) {
            if (/\d/.test(newInputValue[newPosition])) {
              digitsFound++;
            }
            newPosition++;
          }
          
          input.selectionStart = newPosition;
          input.selectionEnd = newPosition;
          this.state.cursorPosition = newPosition;
        },
        
        updateDateInput: function() {
          // Format basic date and time
          const day = this.state.selectedDate.getDate().toString().padStart(2, '0');
          const month = (this.state.selectedDate.getMonth() + 1).toString().padStart(2, '0');
          const year = this.state.selectedDate.getFullYear();
          const hours = this.state.selectedDate.getHours().toString().padStart(2, '0');
          const minutes = (this.state.selectedTenMinute + this.state.selectedMinute).toString().padStart(2, '0');
          
          // Format with or without seconds based on configuration
          if (this.config.showSeconds) {
            // Format with seconds (DD.MM.YYYY HH:MM:SS)
            const seconds = this.state.selectedDate.getSeconds().toString().padStart(2, '0');
            this.elements.dateInput.value = `${day}.${month}.${year} ${hours}:${minutes}:${seconds}`;
          } else {
            // Format without seconds (DD.MM.YYYY HH:MM)
            this.elements.dateInput.value = `${day}.${month}.${year} ${hours}:${minutes}`;
          }
        },
        
        handleInputChange: function(updateInput = true) {
          // Get the value from the input field
          const inputValue = this.elements.dateInput.value;
          
          // Regex patterns for both with and without seconds
          const regexWithSeconds = /^(\d{2})\.(\d{2})\.(\d{4}) (\d{2}):(\d{2}):(\d{2})$/;
          const regexWithoutSeconds = /^(\d{2})\.(\d{2})\.(\d{4}) (\d{2}):(\d{2})$/;
          
          // Try to match with the appropriate format based on config
          let match;
          let seconds = 0;
          
          if (this.config.showSeconds) {
            match = inputValue.match(regexWithSeconds);
            if (match) {
              const [_, day, month, year, hours, minutes, secs] = match;
              seconds = parseInt(secs);
            }
          } else {
            match = inputValue.match(regexWithoutSeconds);
          }
          
          if (match) {
            const [_, day, month, year, hours, minutes] = match;
            
            // Create a new date from the entered value
            const newDate = new Date(
              parseInt(year),
              parseInt(month) - 1,
              parseInt(day),
              parseInt(hours),
              parseInt(minutes),
              seconds
            );
            
            // Check that the date is valid
            if (!isNaN(newDate.getTime())) {
              // We update all states
              this.state.currentDate = new Date(newDate);
              this.state.selectedDate = new Date(newDate);
              this.state.selectedHour = newDate.getHours();
              this.state.selectedTenMinute = Math.floor(newDate.getMinutes() / 10) * 10;
              this.state.selectedMinute = newDate.getMinutes() % 10;
              this.state.selectedSecond = newDate.getSeconds();
              
              // Redraw all components
              this.renderCalendarDays();
              this.renderHours();
              this.renderTenMinutes();
              this.renderMinutes();
              
              // Only render seconds if configured to show
              if (this.config.showSeconds) {
                this.renderSeconds();
              }
              
              // Only update the input field if requested (to avoid infinite loops)
              if (updateInput) {
                this.updateDateInput();
              }
              
              return true;
            } else {
              // If the date is invalid, restore the current value
              if (updateInput) {
                this.updateDateInput();
              }
              return false;
            }
          } else {
            // If the format is incorrect, restore the current value
            if (updateInput) {
                this.updateDateInput();
            }
            return false;
          }
        }
      };
      
      // Initialize the calendar
      datePicker.init();
    });
  </script>
</body>
</html>
